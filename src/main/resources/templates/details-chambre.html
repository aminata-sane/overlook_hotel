<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="'Chambre ' + ${chambre.type.libelle} + ' - Overlook Hotel'"></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #e74c3c;
            --accent-color: #f39c12;
            --light-bg: #ecf0f1;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--light-bg);
            padding-top: 80px;
        }

        .navbar-custom {
            background: var(--primary-color) !important;
        }

        .room-gallery {
            height: 400px;
            background-size: cover;
            background-position: center;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }

        .room-price-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--secondary-color);
            color: white;
            padding: 15px 25px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 1.3rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .room-details-card {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.1);
            margin-top: -50px;
            position: relative;
            z-index: 10;
        }

        .room-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .room-features {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 30px 0;
        }

        .room-feature {
            background: var(--light-bg);
            color: var(--primary-color);
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .amenities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .amenity-item {
            background: white;
            border: 2px solid var(--light-bg);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .amenity-item:hover {
            border-color: var(--accent-color);
            transform: translateY(-5px);
        }

        .amenity-icon {
            font-size: 2rem;
            color: var(--accent-color);
            margin-bottom: 10px;
        }

        .booking-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.1);
            position: sticky;
            top: 100px;
        }

        .btn-book {
            background: linear-gradient(45deg, var(--secondary-color), var(--accent-color));
            border: none;
            border-radius: 10px;
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
            width: 100%;
        }

        .btn-book:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
            color: white;
        }

        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            padding: 12px 15px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 0.2rem rgba(243, 156, 18, 0.25);
        }

        .price-breakdown {
            background: var(--light-bg);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark navbar-custom fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-hotel"></i> Overlook Hotel
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">Accueil</a>
                <a class="nav-link" href="/chambres">Chambres</a>
                <a class="nav-link" href="/connexion">Connexion</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Galerie photo -->
        <div class="room-gallery" th:style="'background-image: url(' + ${chambre.type.name() == 'SIMPLE' ? 'https://images.unsplash.com/photo-1618773928121-c32242e63f39?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=2000&amp;q=80' : chambre.type.name() == 'DOUBLE' ? 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=2000&amp;q=80' : chambre.type.name() == 'SUITE' ? 'https://images.unsplash.com/photo-1582719478250-c89cae4dc85b?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=2000&amp;q=80' : chambre.type.name() == 'FAMILIALE' ? 'https://images.unsplash.com/photo-1571003123894-1f0594d2b5d9?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=2000&amp;q=80' : chambre.type.name() == 'DELUXE' ? 'https://images.unsplash.com/photo-1591088398332-8a7791972843?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=2000&amp;q=80' : 'https://images.unsplash.com/photo-1566665797739-1674de7a421a?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=2000&amp;q=80'} + ')'">
            <div class="room-price-badge" th:text="${chambre.prix} + '€/nuit'"></div>
        </div>

        <div class="row">
            <div class="col-lg-8">
                <!-- Détails de la chambre -->
                <div class="room-details-card">
                    <h1 class="room-title" th:text="'Chambre ' + ${chambre.type.libelle} + ' - ' + ${chambre.numero}"></h1>
                    
                    <div class="room-features">
                        <span class="room-feature">
                            <i class="fas fa-users"></i> 
                            <span th:text="${chambre.capacite} + ' personnes'"></span>
                        </span>
                        <span class="room-feature">
                            <i class="fas fa-bed"></i> 
                            <span th:text="${chambre.type.libelle}"></span>
                        </span>
                        <span class="room-feature" th:if="${chambre.disponible}">
                            <i class="fas fa-check-circle text-success"></i> 
                            Disponible
                        </span>
                    </div>

                    <div class="mb-4">
                        <h4>Description</h4>
                        <p th:text="${chambre.description != null ? chambre.description : 'Une chambre élégante et confortable dans un cadre luxueux. Profitez d''un séjour inoubliable avec tous les équipements modernes et un service d''exception.'}"></p>
                    </div>

                    <!-- Équipements -->
                    <div th:if="${!chambre.equipements.empty}">
                        <h4>Équipements & Services</h4>
                        <div class="amenities-grid">
                            <div class="amenity-item" th:each="equipement : ${chambre.equipements}">
                                <div class="amenity-icon">
                                    <i class="fas" th:class="${equipement.name() == 'JACUZZI' ? 'fas fa-hot-tub' : 
                                                              equipement.name() == 'LIT_MASSANT' ? 'fas fa-bed' :
                                                              equipement.name() == 'FAUTEUIL_MASSAGE_ELECTRIQUE' ? 'fas fa-chair' :
                                                              equipement.name() == 'SOL_CHAUFFANT' ? 'fas fa-thermometer-half' :
                                                              equipement.name() == 'ECRAN_HOME_CINEMA' ? 'fas fa-tv' :
                                                              equipement.name() == 'BALCON' ? 'fas fa-door-open' :
                                                              equipement.name() == 'VUE_MER' ? 'fas fa-water' :
                                                              equipement.name() == 'VUE_MONTAGNE' ? 'fas fa-mountain' :
                                                              equipement.name() == 'MINI_BAR' ? 'fas fa-wine-glass' :
                                                              equipement.name() == 'CLIMATISATION' ? 'fas fa-snowflake' :
                                                              equipement.name() == 'WIFI_PREMIUM' ? 'fas fa-wifi' :
                                                              'fas fa-lock'}"></i>
                                </div>
                                <h6 th:text="${equipement.libelle}"></h6>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <!-- Formulaire de réservation -->
                <div class="booking-card">
                    <h4 class="mb-4"><i class="fas fa-calendar-check"></i> Réserver cette chambre</h4>
                    
                    <form th:action="@{/reserver}" method="post" th:object="${reservation}">
                        <input type="hidden" th:field="*{chambre}" th:value="${chambre.id}">
                        
                        <div class="mb-3">
                            <label for="dateArrivee" class="form-label">
                                <i class="fas fa-calendar-alt"></i> Date d'arrivée
                            </label>
                            <input type="date" class="form-control" id="dateArrivee" 
                                   th:field="*{dateArrivee}" 
                                   th:value="${param.dateArrivee != null ? param.dateArrivee[0] : ''}"
                                   th:min="${#temporals.format(#temporals.createNow(), 'yyyy-MM-dd')}" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="dateDepart" class="form-label">
                                <i class="fas fa-calendar-alt"></i> Date de départ
                            </label>
                            <input type="date" class="form-control" id="dateDepart" 
                                   th:field="*{dateDepart}"
                                   th:value="${param.dateDepart != null ? param.dateDepart[0] : ''}"
                                   th:min="${#temporals.format(#temporals.createNow(), 'yyyy-MM-dd')}" required>
                        </div>
                        
                        <div class="row">
                            <div class="col-6">
                                <label for="nombreAdultes" class="form-label">
                                    <i class="fas fa-user"></i> Adultes
                                </label>
                                <select class="form-select" id="nombreAdultes" th:field="*{nombreAdultes}" required>
                                    <option value="">Adultes</option>
                                    <option value="1" th:selected="${param.nombreAdultes != null and param.nombreAdultes[0] == '1'}">1</option>
                                    <option value="2" th:selected="${param.nombreAdultes != null and param.nombreAdultes[0] == '2'}">2</option>
                                    <option value="3" th:selected="${param.nombreAdultes != null and param.nombreAdultes[0] == '3'}">3</option>
                                    <option value="4" th:selected="${param.nombreAdultes != null and param.nombreAdultes[0] == '4'}">4</option>
                                    <option value="5" th:selected="${param.nombreAdultes != null and param.nombreAdultes[0] == '5'}">5</option>
                                    <option value="6" th:selected="${param.nombreAdultes != null and param.nombreAdultes[0] == '6'}">6</option>
                                </select>
                            </div>
                            <div class="col-6">
                                <label for="nombreEnfants" class="form-label">
                                    <i class="fas fa-child"></i> Enfants
                                </label>
                                <select class="form-select" id="nombreEnfants" th:field="*{nombreEnfants}">
                                    <option value="0" th:selected="${param.nombreEnfants == null or param.nombreEnfants[0] == '0'}">0</option>
                                    <option value="1" th:selected="${param.nombreEnfants != null and param.nombreEnfants[0] == '1'}">1</option>
                                    <option value="2" th:selected="${param.nombreEnfants != null and param.nombreEnfants[0] == '2'}">2</option>
                                    <option value="3" th:selected="${param.nombreEnfants != null and param.nombreEnfants[0] == '3'}">3</option>
                                    <option value="4" th:selected="${param.nombreEnfants != null and param.nombreEnfants[0] == '4'}">4</option>
                                </select>
                            </div>
                        </div>

                        <div class="price-breakdown">
                            <div class="d-flex justify-content-between">
                                <span>Prix par nuit:</span>
                                <strong th:text="${chambre.prix} + '€'"></strong>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>Nombre de nuits:</span>
                                <strong id="nombreNuits">-</strong>
                            </div>
                            <hr>
                            <div class="d-flex justify-content-between fs-5">
                                <strong>Total:</strong>
                                <strong id="prixTotal" th:data-prix="${chambre.prix}">-</strong>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-book">
                            <i class="fas fa-calendar-check"></i> Réserver maintenant
                        </button>
                    </form>

                    <div class="mt-3 text-center">
                        <small class="text-muted">
                            <i class="fas fa-shield-alt"></i> Réservation sécurisée - Annulation gratuite
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Calcul du prix total
        function calculerPrix() {
            const dateArrivee = document.getElementById('dateArrivee').value;
            const dateDepart = document.getElementById('dateDepart').value;
            const prixParNuit = parseFloat(document.getElementById('prixTotal').dataset.prix);
            
            if (dateArrivee && dateDepart) {
                const arrivee = new Date(dateArrivee);
                const depart = new Date(dateDepart);
                const diffTime = Math.abs(depart - arrivee);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays > 0) {
                    const total = prixParNuit * diffDays;
                    document.getElementById('nombreNuits').textContent = diffDays;
                    document.getElementById('prixTotal').textContent = total + '€';
                } else {
                    document.getElementById('nombreNuits').textContent = '-';
                    document.getElementById('prixTotal').textContent = '-';
                }
            }
        }

        // Validation des dates
        document.getElementById('dateArrivee').addEventListener('change', function() {
            const dateArrivee = this.value;
            const dateDepart = document.getElementById('dateDepart');
            dateDepart.min = dateArrivee;
            
            if (dateDepart.value && dateDepart.value <= dateArrivee) {
                dateDepart.value = '';
            }
            calculerPrix();
        });

        document.getElementById('dateDepart').addEventListener('change', calculerPrix);

        // Calcul initial si les dates sont pré-remplies
        window.addEventListener('load', calculerPrix);
    </script>
</body>
</html>
